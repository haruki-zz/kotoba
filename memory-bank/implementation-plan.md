# 实施计划

1. 初始化开发环境
   - 步骤：确认 Node 版本满足 Electron/Vite 要求，执行依赖安装，配置 `.env.local`，仅包含 OpenAI/Google 密钥占位（空值即可）避免后续读取报错。
   - 结果：项目可在本地安装依赖并具备基础环境变量文件（仅密钥）。
   - 验证：运行 `npm install` 不报错；执行 `npm run lint` 目前仅检查配置是否就绪。

2. 搭建 Electron + React/Vite 基础骨架
   - 步骤：创建 `src/main` 与 `src/renderer` 基础入口，配置 electron-vite 或等效脚手架、`electron-builder` 打包目标，渲染端暂时保留空白页面。
   - 结果：可启动空白窗口的跨平台桌面应用，主/渲染进程热更新可用，为后端功能提供运行容器。
   - 验证：执行 `npm run dev` 启动后看到空白窗口且控制台无报错；执行 `npm run build` 生成产物目录。

3. 配置 ESLint、Prettier（先行保证规范）
   - 步骤：接入 ESLint + Prettier 配置与 scripts，约束 TypeScript 规则；Tailwind 暂缓到 UI 阶段。
   - 结果：代码有统一风格检查，后续开发可即时发现格式问题。
   - 验证：运行 `npm run lint` 确认无格式错误。

4. 定义共享类型与 SM-2 计算
   - 步骤：在 `src/shared` 定义词条（无 `source` 字段）、复习日志、活跃度数据类型与 JSON 校验逻辑；缺失 `sm2` 字段时按默认值自动补全，缺失时间字段按当前时间补全；编写 SM-2 更新与队列排序纯函数。
   - 结果：拥有可复用的纯函数与类型，供主/渲染进程调用，默认补全逻辑明确。
   - 验证：编写 Vitest 单测覆盖 SM-2 更新公式、队列排序、补全逻辑与 JSON 校验的正常与边界输入，运行 `npm test -- shared`。

5. 主进程存储层（文件读写）
   - 步骤：在 `src/main` 实现对 `data/words.json`、`data/activity.json` 的读写，采用临时文件写入再替换；封装新增/编辑/删除词条、按评分更新 SM-2 字段、聚合活跃度（`added_count`、`review_count`、`streak`）的函数。缺失 `sm2` 或时间字段时按默认/当前时间补全，字段名遵循设计文档（`term`、`kana`、`definition_ja` 等），不写入 `source`。
   - 结果：可靠的本地数据存储，数据结构与设计文档示例一致（words 数组 + activity.days 映射），补全逻辑一致。
   - 验证：使用 Vitest + 临时目录单测验证写入后文件内容与 JSON 校验/补全一致，模拟磁盘写失败时保证原文件未损坏。

6. 主进程 AI 提供商适配层（优先完成）
   - 步骤：抽象统一接口封装 OpenAI 与 Google 调用，Google 使用官方 Gemini SDK（首选 Gemini Flash 2.5 Lite），严格按官方文档配置请求头、路径与参数，加入合理的默认超时与长度限制，提供 mock 实现供无网络测试；不返回或记录完整密钥。
   - 结果：可通过统一方法生成词条内容，并具备可替换的 provider 结构，确认能正确接收并解析返回字段。
   - 验证：单测用 mock fetch 验证超时/错误分支与字段解析；在 dev 模式下以 mock provider 生成固定响应，确保无密钥时也能走通流程。

7. IPC 合同与安全桥接
   - 步骤：定义类型安全的 IPC 信道，暴露新增词条（含 AI 生成）、加载词库、拉取复习队列、提交评分、读取/写入活跃度、导入/导出、设置 provider 与密钥等接口；通过 `contextBridge` 限定可调用列表。
   - 结果：渲染进程只能调用受控接口，返回值已过校验。
   - 验证：编写主进程集成单测，使用 electron-mock 或直接调用 handler 验证各接口的入参校验与返回格式；确保未知信道无法调用。

8. 后端导入/导出与数据校验
   - 步骤：在主进程实现导入/导出 `words.json`（JSON 数组）与 `activity.json`，导出可额外提供 CSV（词条字段）；导入时进行 schema 校验并以 `term` 去重，保留传入的 `sm2` 与时间戳，非法记录跳过且报告。
   - 结果：数据迁移与校验逻辑与本地文件格式一致，等待前端入口接入。
   - 验证：单测覆盖合法/非法文件、重复 `term` 覆盖、无效记录跳过；模拟磁盘文件读写，确认错误分支不会污染现有数据。

9. 渲染进程状态管理（Zustand）
   - 步骤：建立全局 store，包含词库列表、当前复习队列、session 状态、活跃度数据、AI provider 配置；封装调用 IPC 的异步 actions。
   - 结果：前端组件可通过 store 获取数据与触发异步操作，状态与主进程数据同步。
   - 验证：编写 store 单测，mock IPC 层验证 actions 对状态的更新与错误处理路径。

10. 配置 Tailwind 与基础主题
    - 步骤：在 renderer 集成 Tailwind，配置设计文档色板（#F8F5F0/#EEF1F4 背景、主色 #1F6F8B、强调色 #F0A35E）、基础阴影与字体栈（Inter + Noto Serif JP，数字用 JetBrains Mono），设置全局样式。
    - 结果：前端可使用与设计一致的原子化样式。
    - 验证：运行 `npm run lint` 确认样式文件通过；启动 `npm run dev` 查看全局色板与字体是否生效（可用占位文本）。

11. 新增词条流程（最小可用 UI）
    - 步骤：实现表单输入单词、触发 AI 生成预览、允许用户编辑结果后保存；保存成功刷新词库与活跃度。
    - 结果：用户可新增词条并看到持久化效果。
    - 验证：编写 React Testing Library 测试，mock IPC 返回，验证表单校验、加载/错误提示、保存后列表刷新；手动运行 `npm run dev` 新增词条并检查 `data/words.json` 写入。

12. 复习队列与 SM-2 更新 UI
   - 步骤：渲染端加载待复习队列，卡片正反面切换，评分（容易/一般/困难）后调用 IPC 更新词条与活跃度；无待复习词时提示「今日无计划复习」并可进入自选复习。
   - 结果：用户可按照 SM-2 流程复习并更新下一次时间，`review_count` 每次评分即时写入 `activity.json`。
   - 验证：组件测试覆盖翻转与评分按钮行为，断言调用的 IPC 参数；单测验证 SM-2 更新后 `next_review_at` 合法；手动复习一次后检查 `activity.json` 与 `words.json`。

13. 活跃度与 streak 视图
    - 步骤：实现按日展示新增词数与复习次数的热力格，显示连续活跃天数（streak），hover 展示详情。
    - 结果：用户可视化每日活跃度与 streak。
    - 验证：组件测试使用固定数据渲染颜色深浅、streak 计算与 tooltip 文案；手动新增/复习后查看 UI 变化与连续天数。

14. 前端导入/导出与错误提示
    - 步骤：在 UI 提供导入 JSON、导出 JSON/CSV 入口，展示进度与错误提示，对接主进程校验结果。
    - 结果：用户可安全迁移数据，损坏文件被拒绝。
    - 验证：组件测试覆盖合法/非法文件流程、重复 `term` 提示；手动导入/导出小样本文件并在磁盘检查内容。

15. 设置页（LLM 提供商与密钥）
    - 步骤：提供 provider 下拉与密钥输入，主进程使用系统安全存储保存密钥，不回显完整值；增加测试用 mock provider 选项。
    - 结果：用户可切换模型并安全存储密钥，默认不泄露。
    - 验证：组件测试验证表单校验与 IPC 调用；手动切换 provider、重启应用后检查设置持久化。

16. 打包与发布烟测
    - 步骤：配置 `electron-builder` 目标（macOS dmg/zip、Windows nsis/portable），校验静态资源与环境变量注入；生成安装包做最小功能回归。
    - 结果：可分发的安装包，基础功能正常。
    - 验证：运行 `npm run build` 与 `npm run pack`，在本地安装包内完成新增词条、复习、活跃度查看的手动测试。

17. UI 设计规范落地（主题与资源）
    - 步骤：按 UI 设计文档抽取色板（#F8F5F0/#EEF1F4 背景、#1F6F8B 主色、#F0A35E 强调）、字体（Inter + Noto Serif JP，数字 JetBrains Mono）、间距与动效（翻面/淡入 150–200ms），配置 Tailwind/全局 CSS 变量；准备线性图标与轻噪点纸纹理；整理描边/悬浮/禁用等基础按钮与输入态。
    - 结果：形成与设计一致的主题 tokens 与基础样式，后续组件无需重复定义视觉细节。
    - 验证：`npm run dev` 查看全局背景、字体与按钮态颜色/字号符合设计规范，lint 通过。

18. 主界面布局与导航搭建
    - 步骤：搭建左侧窄栏导航（仅「新增单词」「复习」「词库」「统计」四入口），主区域保持单列宽约 960px，顶部保留页面级标题与主行动按钮；为新增页实现「输入→生成预览→保存/手动完成」三步骨架与默认聚焦。
    - 结果：界面信息架构与设计文档一致，主要任务路径在首屏即可完成。
    - 验证：在不同分辨率下手动确认导航宽度、单栏居中与按钮/输入聚焦状态；运行 AddWordFlow 等相关测试确保生成/保存流程保持通过。

19. 复习卡片与交互强化
    - 步骤：更新复习卡片为中央单卡布局，支持 200ms 翻面动画与长词自适应；保留左右切换与进度条+剩余文案，评分按钮调整为「容易/一般/困难」三档并附快捷键提示。
    - 结果：复习流突出当前卡片与三档评分，交互与动画符合设计预期。
    - 验证：补充/运行 ReviewSession 测试覆盖进度计算、按钮态与键盘事件；手动翻转/评分确认动画、禁用态与导航无异常。

20. 统计与活跃度页
    - 步骤：在统计页首屏展示今日新增/复习/连续天数卡片与主 CTA「去复习」，下方单列展示活跃度热力格和词库难度占比（easy/medium/hard 扇形图），悬浮显示具体数值，可跳转到对应列表或复习。
    - 结果：统计信息按设计一屏可见，活跃度与难度分布易读可交互。
    - 验证：更新 ActivityHeatmap/DifficultyChart 相关测试覆盖色阶映射、tooltip 与跳转路径；手动 hover/点击确认展示与状态切换。

21. 响应式与可访问性验收
    - 步骤：保持左侧导航 + 单栏内容在 ≥960px 展示，低于该宽度时导航可收起为顶部/底部栏，内容保持单列；确保按钮高度 ≥ 40px、Tab/Enter/Space 可完成主要操作，对比度符合色板，窄屏下评分按钮分两行。
    - 结果：在不同分辨率与输入方式下，布局、文案和焦点顺序满足设计与无障碍要求。
    - 验证：用浏览器 devtools 手动切换断点检查布局与焦点序列，必要时新增辅助测试；确保 ESLint/现有测试通过。

22. 回归测试与文档补充
    - 步骤：整理新增测试覆盖率报告，补充 README/用户指引，若有架构调整同步更新设计文档与架构说明。
    - 结果：测试覆盖核心路径，文档同步，团队可交接。
    - 验证：执行 `npm test -- --coverage` 达到预期阈值；人工审阅文档与设计文件更新完备。
