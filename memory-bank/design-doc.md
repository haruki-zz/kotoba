# 日语单词记忆工具设计文档

## 1. 背景与目标

- 个人/小规模用户的日语单词学习助手，侧重语境化释义与间隔复习，不讨论实现细节。
- 平台：跨平台桌面端（优先 macOS / Windows，暂不做 Linux）
- 目标：降低录入成本、提高记忆效率、建立稳定复习习惯。
- 首批优先：高质量生成（情景化释义/例句）、SM-2 复习体验、统计反馈、词库管理与编辑。

## 2. 用户与场景

- 用户画像：生活在日本的外国人，随手记录日常遇到的新词，自用为主，未来考虑产品化。
- 典型场景：每日 1-2 次使用，每次约 20 分钟；录入当日新词，快速校对生成结果；使用 SRS 队列复习旧词。
- 痛点：语境贫乏、释义不清晰、复习负担大。

## 3. 成功指标

- 连续活跃天数（每日活跃、断签不可补）。
- 复习完成率与掌握度分布（easy/medium/hard）。
- 今日/本周新增与复习计数；高遗忘风险词被关注/复习的覆盖度。

## 4. 范围与版本

- v1 覆盖：词条新增/查看/编辑与删除、AI 生成与手动覆盖、SM-2 复习队列、首页统计反馈、基础设置。
- 暂不做：词库导入/导出、更多标签/来源/词性、多人协作。

## 5. 核心功能

- 词条管理：列表+搜索；详情可重生成或手动覆盖；删除含二次确认；悬浮二级页编辑（背景虚化）。
- AI 生成：基于用户输入的单词，生成假名、情景化解释、场景描述、生活化例句；用户可手动修订。
- 学习（今日新增）：新增入口（加号→悬浮页），生成后可微调；列表展示词+假名+情景提示，支持快速预览与修改。
- 复习：按 SM-2 队列；初始仅展示单词；可跳过（自动标记 easy）或展开详情后选择掌握度（默认 medium）；支持左右箭头/快捷键双向切换与“回退上一条”（Ctrl+Z）；进度条显示剩余。
- 统计与反馈：首页常驻连续天数热力图、掌握度分布环图、随机 5 个 hard 高遗忘风险词卡片、本周新增/复习折线图、今日新增/复习计数。
- 设置：复习队列默认 30（可自定义）；例句风格=生活口语（例句 15-25 字，场景 1 句 30-40 字）；AI provider 选择；light/dark 模式切换。

## 6. 关键交互流程

- 今日学习
  1. 主页进入“今日学习”或左侧导航；默认展示当日新增列表。
  2. 点击加号→悬浮页输入单词→AI 生成假名/解释/场景/例句→用户校对微调→保存后返回列表。
  3. 新增词自动加入 SM-2 队列（当日不自动进入复习）。
- 复习
  1. 进入复习页，按 next_due_at 排序取队列（默认 30，可配置）。
  2. 初始仅显示单词；用户可直接跳过（系统标记 easy 并进入下一条），或展开详情查看假名/解释/场景/例句后选择掌握度（easy/medium/hard，未选则 medium）。
  3. 左右箭头/快捷键双向切换；提供“回退上一条”按钮（Ctrl+Z）；进度条显示剩余。
  4. 队列完成后直接结束，无“再练 5 个 hard”提示；空队列文案：今日复习已完成，去巩固新增或放松一下吧，附“去今日学习”“去词库”入口。
- 词库
  1. 列表+搜索；点击词条→悬浮详情页展示全部字段。
  2. 支持重生成/手动编辑，保存或取消；删除需确认后永久删除。
- 首页
  - 导航默认落点；展示连续天数热力图、掌握度分布、随机 5 个 hard 词卡片、本周新增/复习折线图、今日新增/复习计数。
- 页面流转
  - 左侧导航：主页、今日学习、复习、词库、设置。
  - 悬浮编辑页用于新增/编辑，背景虚化；复习完成返回上层或停留。

## 7. 数据模型（词条）

- 基础字段：word（原词）、reading（假名读音）、context_expl（情景化解释）、scene_desc（场景描述）、example（生活化例句，含语境）、difficulty（easy/medium/hard）。
- SM-2 字段：ef（默认 2.5）、interval_days、repetition、last_review_at（ISO 时间）、next_due_at（ISO 时间）。
- 其他：created_at/updated_at；source/标签/词性暂不提供。

## 8. SM-2 逻辑

- 质量映射：easy=5，medium=4，hard=3；q<3 视为失败（本版不采集）。
- 规则：
  - 若 q<3：repetition=0，interval=1。
  - 否则 repetition+1；repetition=1 → interval=1；repetition=2 → interval=6；之后 interval=round(prev_interval\*EF)。
  - EF' = EF + (0.1 - (5-q) _ (0.08 + (5-q) _ 0.02))，下限 1.3。
  - next_due_at = last_review_at + interval_days。
- 调度：复习页按 next_due_at 升序取队列；跳过直接使用 easy（q=5）；未选择掌握度默认 medium（q=4）。

## 9. 体验与规则

- 今日学习与复习分离，不自动衔接。
- 高遗忘风险：从 hard 标记中随机展示 5 个。
- 例句与场景风格：生活化、口语化；例句 15-25 字，场景描述单句 30-40 字。
- 重生成保留原版，可回滚。
- 无“再练 5 个 hard”提示；每日复习次数不限。

## 10. 风险与开放问题

- 生成质量：需确保例句承载完整语义并凸显语境差异，可能需提示或后续调优。
- 数据一致性：跳过=easy 的规则会抬高 EF，需关注是否导致间隔过长。
- 快捷键覆盖：需校验与系统/浏览器快捷键冲突。
- 未来扩展：词库导入/导出、多端同步、更多标签/来源/词性、多人协作尚未覆盖。
