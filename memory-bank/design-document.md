# 日语单词记忆桌面应用 设计文档

## 1. 概述

本项目是一款跨平台桌面端（macOS / Windows）日语单词记忆工具。  
核心能力包括：

- 用户录入单词，由 AI 自动生成假名读音、日文释义、情感场景和例句；
- 采用单词卡片形式进行记忆与复习；
- 使用 SM-2 间隔重复算法安排复习计划；
- 基于本地 JSON 文件保存所有数据；
- 提供连续活跃天数与活跃度 Heat Map 等统计信息；
- 前端样式设计统一采用 Tailwind CSS 风格体系。

> 本设计文档聚焦「产品与功能设计」，尽量不涉及具体技术栈与实现细节。

---

## 2. 目标与约束

### 2.1 产品目标

- **降低造卡成本**：用户只需输入单词，AI 自动生成完整卡片内容。
- **提高记忆效率**：从初始版本起即使用 SM-2 算法安排复习。
- **强化学习动力**：通过连续活跃天数与可视化活跃度的方式提升粘性。
- **跨平台可用**：在 macOS 与 Windows 上提供一致的体验。
- **本地优先**：所有数据保存在本地 JSON 文件，用户完全掌控个人词库。

### 2.2 非目标

- 不做账号系统与云同步（本地数据为主）。
- 不支持移动端（iOS / Android）。
- 不内置大规模预置词库，仅支持用户自建词库（后续可扩展）。

### 2.3 设计约束

- **AI 调用**：调用 AI 服务统一通过官方提供的 SDK 封装。
- **数据存储**：不使用数据库引擎，统一使用 JSON 文件进行本地持久化。
- **样式规范**：前端 UI 设计采用 Tailwind CSS 的原子类思想与命名体系。

---

## 3. 核心功能

### 3.1 新增单词

**功能目标**
用户录入单词，并由 AI 自动生成卡片内容。

**流程概述**

1. 用户在「新增单词」界面输入 `term`（汉字或假名）。
2. 应用调用 AI 服务（通过官方 SDK），生成：
   - `kana`：假名读音；
   - `definition_ja`：日文释义；
   - `scene_ja`：情境/情感描述；
   - `example_ja`：日文例句。
3. 将生成结果以预览卡片形式展示，用户可手动修改各字段。
4. 用户确认后，将新的单词对象写入本地 JSON 文件，并初始化该单词的 SM-2 状态。
5. 同时更新「当日新增单词数」统计数据。

**异常处理**

- AI 调用失败时，支持用户手动填入所有字段；
- 若字段不完整或用户取消，则不写入词库。

---

### 3.2 单词卡片展示

**功能目标**
以卡片形式展示单词信息，支持正反翻转。

**卡片结构**

- **正面**
  - 单词 `term`
  - 假名 `kana`
- **背面**
  - 单词 `term`
  - 假名 `kana`
  - 日文释义 `definition_ja`
  - 场景描述 `scene_ja`
  - 例句 `example_ja`

**交互行为**

- 点击卡片或使用快捷键完成正/反面切换；
- 使用左右方向键或相应 UI 控件切换上一张/下一张卡片；
- 卡片样式（阴影、圆角、布局）使用 Tailwind CSS 原子类设计，保持简洁一致。

---

### 3.3 复习功能（SM-2 算法）

**功能目标**  
根据用户记忆程度，使用 SM-2 算法为每个单词计算下一次复习时间，从而实现间隔重复。

**SM-2 状态字段（每个单词）**

- `repetition`：成功记住的次数；
- `interval`：当前间隔天数；
- `easiness`：易记系数（默认 2.5）；
- `next_review_at`：下次复习时间（时间戳）。

**复习流程**

1. 用户在「复习」页面发起复习：
   - 应用从本地 JSON 中读取词库；
   - 过滤出 `next_review_at <= 当前时间` 的单词，生成当次复习队列；
   - 若队列为空，可以提示「今日无计划复习」，并可选提供额外复习模式。
2. 对于每一张卡片：
   - 先显示正面，用户尝试回忆；
   - 用户翻转卡片查看背面；
   - 用户根据记忆程度给出评分（easy, medium, hard）。
3. 应用根据评分应用 SM-2 算法：
   - 更新当前单词的 `repetition`、`interval`、`easiness`、`next_review_at`；
   - 将更新后的单词写回 JSON 文件。
4. 一次完整的复习流程视为一次「复习事件」，增加当日 `review_count`。

---

### 3.4 词库管理

**功能目标**  
让用户方便地浏览、搜索、编辑和删除已保存的单词。

**主要能力**

- 以列表或表格形式展示所有单词：
  - 显示关键信息：`term`、`kana`、简要释义、创建日期、下次复习日期等；
- 支持搜索与过滤：
  - 按单词 / 假名关键字搜索；
  - 可按创建时间或下次复习日期排序。
- 编辑：
  - 用户可打开单词详情对话框（弹窗或单独页面），修改假名、释义、场景、例句等；
- 删除：
  - 支持单条删除，并有确认提示；
  - （可选）支持多选删除。

所有编辑与删除操作均同步更新本地 JSON 文件。

---

### 3.5 用户活跃度统计

**统计内容**

- 每日活跃度：
  - `added_count`：当日新增单词数；
  - `review_count`：当日复习次数；
  - 可定义总活跃度 = `added_count + review_count`。
- 连续活跃天数（streak）：
  - 以最近一天为起点，向前统计连续活跃（总活跃度 > 0）的天数。
- 活跃度 Heat Map：
  - 按日期渲染网格。
  - 展示最近一段时间（如数月至一年）的整体学习情况。
  - 使用简单 SVG 或 canvas 渲染按日的活跃度格子，颜色深浅表示活跃度大小。
- 词库统计：
  - 空心扇形图展示easy, medium, hard 单词数占总词库数量的百分比。

**展示形式**

- 概览区域：
  - 今日新增单词数；
  - 今日复习次数；
  - 当前连续活跃天数。
- 图形区域：
  - 使用基于 Tailwind CSS 的栅格布局展示 Heat Map；
  - 保持配色与明暗对比简洁清晰。

---

## 4. 系统逻辑与模块划分（抽象）

> 本节仅描述逻辑模块与职责，不涉及具体框架与语言。

### 4.1 逻辑模块

- **AI 服务模块**
  - 封装对官方 SDK 的调用；
  - 对外提供统一的 `generateWordCard(term)` 能力；
  - 负责错误重试与异常处理。

- **数据管理模块**
  - 负责 JSON 文件的读取与写入；
  - 在内存中维护：
    - 词库集合；
    - 活跃度数据；
  - 提供增删改查接口给其他模块调用。

- **SM-2 算法模块**
  - 根据给定评分 `q` 更新单词的 `repetition`、`interval`、`easiness` 与 `next_review_at`；
  - 提供筛选「应复习单词」的辅助函数。

- **统计与分析模块**
  - 记录每天的新增与复习事件；
  - 计算每日活跃度与连续活跃天数；
  - 为统计界面提供聚合后的数据视图。

- **UI 交互模块**
  - 负责：
    - 新增单词界面；
    - 复习界面（卡片翻转、评分交互）；
    - 词库管理界面；
    - 统计与 Heat Map 界面。
  - 使用 Tailwind CSS 类进行布局与样式控制。

---

## 5. 数据结构概要（JSON）

### 5.1 词库数据 `words.json`

示例结构（仅展示关键字段）：

```json
{
  "words": [
    {
      "id": "uuid-1",
      "term": "勉強",
      "kana": "べんきょう",
      "definition_ja": "知識や技能を身につけるために学ぶこと。",
      "scene_ja": "夜遅くまで机に向かって試験の準備をしている。",
      "example_ja": "毎日少しずつ日本語を勉強しています。",
      "created_at": 1710000000000,
      "updated_at": 1710000000000,
      "sm2": {
        "repetition": 0,
        "interval": 0,
        "easiness": 2.5,
        "next_review_at": 1710000000000
      }
    }
  ]
}
```

### 5.2 活跃度数据 activity.json

示例结构（仅展示关键字段）：

```json
{
  "days": {
    "2024-01-01": { "added_count": 5, "review_count": 20 },
    "2024-01-02": { "added_count": 0, "review_count": 10 }
  }
}
```
