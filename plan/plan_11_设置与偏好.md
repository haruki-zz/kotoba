# 计划：设置与偏好

## 计划概述

### 计划目标
实现设置页面与配置持久化，涵盖复习队列长度、例句风格、AI Provider 选择、明暗模式等偏好项。

### 在项目中的位置
为各功能提供可配置参数，影响复习队列生成、生成提示与 UI 主题。

---

## 依赖关系

### 前置条件
- 前置任务：plan_03 - 主进程 API 与基础服务；plan_05 - AI 生成与 Provider 抽象；plan_06 - 渲染端基础框架与设计体系
- 前置数据：可配置项清单与默认值
- 前置环境：设置读写接口可用

### 后续影响
- 后续任务：plan_04 - SM-2 算法与复习队列（队列长度）；plan_05 - AI 生成与 Provider 抽象（Provider 选择）；plan_06 - 渲染端基础框架与设计体系（主题）
- 产出数据：设置存储与前端状态

---

## 子任务分解
**每一个子任务都必须小而具体**

- sub_plan_01 - 确定设置项与默认值
  - 简述：复习队列长度、例句风格、AI Provider、主题模式等
- sub_plan_02 - 主进程设置存储
  - 简述：提供读写接口，校验并持久化设置
- sub_plan_03 - 渲染端设置页面
  - 简述：构建表单，支持保存、重置与即时预览
- sub_plan_04 - 状态同步与生效
  - 简述：保存后同步到相关模块（队列、生成、主题）
- sub_plan_05 - 失败处理与回退
  - 简述：保存失败提示，提供重试或回退到上次有效配置
- sub_plan_06 - 无障碍与响应式
  - 简述：键盘操作、屏幕阅读、移动端布局

---

## 技术方案

### 架构设计
设置服务在主进程存储并校验，渲染端通过表单操作；保存后广播到需要的模块，主题切换与队列长度即时生效。

### 核心技术选型
- 表单校验：React Hook Form + Zod
- 状态广播：Zustand 或轻量事件系统

### 数据模型
设置项包括：队列长度（整数）、例句字数与风格偏好、AI Provider 名称与密钥占位、主题模式（明/暗/跟随系统）。

### 接口设计
提供获取与保存设置的接口；保存时返回最新配置与生效状态。

---

## 执行摘要

### 输入
- 默认设置值与用户输入
- 主进程读写接口

### 处理
- 校验输入、保存配置
- 同步到相关模块并更新 UI

### 输出
- 持久化的设置数据
- 已生效的主题与队列长度

---

## 验收标准
**验收标准必须清晰明确**

### 功能验收
- 设置页可读取现有配置并展示默认值
- 可修改并保存队列长度、例句风格、AI Provider、主题模式
- 保存后相关模块即时生效或提示刷新
- 提供重置与失败提示

### 质量验收
- 校验规则一致，避免无效配置写入
- 主题切换与配置保存无明显延迟

---

## 交付物清单

### 代码文件
- 设置服务与页面组件约定：1 套

### 配置文件
- 默认设置与校验规则说明：1 份

### 文档
- 设置项说明与生效范围：1 份

### 测试文件
- 设置读写与生效测试计划：1 份
