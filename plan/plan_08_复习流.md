# 计划：复习流

## 计划概述

### 计划目标
实现复习页面与交互，展示复习队列、支持掌握度选择、跳过、回退、快捷键与进度提示。

### 在项目中的位置
直接消耗 SM-2 队列与主进程 API，为用户提供核心复习体验并回写数据。

---

## 依赖关系

### 前置条件
- 前置任务：plan_04 - SM-2 算法与复习队列；plan_06 - 渲染端基础框架与设计体系
- 前置数据：队列生成规则、掌握度映射、快捷键定义
- 前置环境：渲染端 API 封装可用

### 后续影响
- 后续任务：plan_10 - 统计与反馈
- 产出数据：复习结果、进度状态、回退栈

---

## 子任务分解
**每一个子任务都必须小而具体**

- sub_plan_01 - 队列获取与初始化
  - 简述：请求待复习列表，初始化本地指针与进度
- sub_plan_02 - 展示与展开交互
  - 简述：默认仅展示单词，展开后显示假名、解释、场景与例句
- sub_plan_03 - 掌握度选择与默认值
  - 简述：提供 easy/medium/hard 选择，未选默认 medium
- sub_plan_04 - 跳过与回退
  - 简述：支持跳过（计作 easy）与回退上一条（Ctrl+Z）
- sub_plan_05 - 进度与快捷键
  - 简述：显示进度条、剩余数量，提供左右箭头与快捷键切换
- sub_plan_06 - 空队列与完成态
  - 简述：空队列提示与引导入口，完成后停留或返回
- sub_plan_07 - 错误与重试
  - 简述：API 失败时的提示与重试机制

---

## 技术方案

### 架构设计
页面由队列容器、卡片展示、控制条、状态提示组成；状态存于局部 store，操作调用封装的复习 API。

### 核心技术选型
- React + Zustand：管理队列状态与回退栈
- Framer Motion：卡片切换与进度动效

### 数据模型
使用队列项包含 word、reading、context_expl、scene_desc、example、difficulty、ef、interval_days、repetition、last_review_at、next_due_at；本地状态包含当前索引、历史栈、完成标记。

### 接口设计
调用队列获取、结果提交、回退接口；返回最新队列状态与统计更新结果。

---

## 执行摘要

### 输入
- 主进程提供的待复习队列
- 用户的掌握度选择与操作

### 处理
- 展示卡片、记录选择或跳过、提交结果
- 支持回退与进度更新

### 输出
- 已更新的复习记录与队列状态
- 完成或空队列提示

---

## 验收标准
**验收标准必须清晰明确**

### 功能验收
- 队列按顺序展示，默认只显示单词
- easy/medium/hard 可选择，未选默认 medium
- 跳过视为 easy，回退可恢复上一条状态
- 进度条与剩余数量正确更新，快捷键可用
- 空队列提示包含导航入口

### 质量验收
- 交互无卡顿，错误提示清晰
- 回退与重复提交处理幂等

---

## 交付物清单

### 代码文件
- 复习页面与交互组件约定：1 套

### 配置文件
- 快捷键与提示文案说明：1 份

### 文档
- 队列与状态流转说明：1 份

### 测试文件
- 复习流程测试计划：1 份
