# 计划：统计与反馈

## 计划概述

### 计划目标
实现首页统计与反馈，包括连续天数热力图、掌握度分布、随机高遗忘风险词卡片、本周新增/复习折线、今日计数。

### 在项目中的位置
为用户提供学习与复习的即时反馈，驱动行为持续性，是首页核心内容。

---

## 依赖关系

### 前置条件
- 前置任务：plan_03 - 主进程 API 与基础服务；plan_04 - SM-2 算法与复习队列
- 前置数据：复习记录与词条数据
- 前置环境：统计查询接口可用

### 后续影响
- 后续任务：plan_06 - 渲染端基础框架与设计体系（动效与组件复用）；plan_11 - 设置与偏好（影响展示选项）
- 产出数据：统计接口结果、可视化组件

---

## 子任务分解
**每一个子任务都必须小而具体**

- sub_plan_01 - 定义统计指标与计算规则
  - 简述：明确连续天数、掌握度分布、每日/每周计数、风险词选择方式
- sub_plan_02 - 实现统计查询与缓存
  - 简述：主进程提供统计聚合，必要时缓存以减轻频繁查询
- sub_plan_03 - 设计可视化组件
  - 简述：构建热力图、环图、折线图与卡片的展示组件
- sub_plan_04 - 数据刷新与状态管理
  - 简述：定义刷新时机（进入页面、操作后）、加载与错误状态
- sub_plan_05 - 交互与动效
  - 简述：为图表与卡片添加进场与悬停动效，保持性能
- sub_plan_06 - 边界与空态处理
  - 简述：数据不足或零值时的展示与提示

---

## 技术方案

### 架构设计
统计服务在主进程聚合数据；渲染端通过数据 hooks 获取并渲染组件，动效与主题复用全局设计体系。

### 核心技术选型
- 主进程聚合查询：使用 SQLite 聚合与排序
- 前端图表：可选轻量图表库或自定义 SVG 组合，结合 Framer Motion 动效

### 数据模型
统计结果包含：连续活跃天数列表、难度分布计数、本周新增/复习按日期计数、今日计数、高遗忘风险词条（来源于 difficulty=hard 的随机子集）。

### 接口设计
提供获取首页统计数据的聚合接口；支持可选时间窗口参数；返回结构化数据供组件消费。

---

## 执行摘要

### 输入
- 词条与复习记录
- 统计时间窗口与过滤条件

### 处理
- 聚合计算、缓存、返回结构化结果
- 在渲染端渲染热力图、环图、折线图、卡片

### 输出
- 首页统计可视化
- 高遗忘风险提示与今日计数

---

## 验收标准
**验收标准必须清晰明确**

### 功能验收
- 能展示连续天数热力图、掌握度环图、本周折线、随机 hard 词卡片、今日计数
- 数据与主进程聚合结果一致，可刷新
- 空数据时有友好提示

### 质量验收
- 渲染性能可接受，动效流畅
- 统计计算准确，时间窗口处理正确

---

## 交付物清单

### 代码文件
- 统计服务与可视化组件约定：1 套

### 配置文件
- 统计刷新策略与缓存配置：1 份

### 文档
- 指标定义与计算说明：1 份

### 测试文件
- 统计与可视化测试计划：1 份
