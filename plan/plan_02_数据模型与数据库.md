# 计划：数据模型与数据库

## 计划概述

### 计划目标
定义词条核心数据模型、SQLite 表结构与共享校验 schema，确保主进程与渲染端一致。

### 在项目中的位置
为主进程 API、SM-2 算法、渲染端表单与校验提供统一的类型与持久化基础。

---

## 依赖关系

### 前置条件
- 前置任务：plan_01 - 工作区搭建与工程规范
- 前置数据：设计文档中的字段定义与 SM-2 规则
- 前置环境：SQLite 驱动与 TypeScript 工具链可用

### 后续影响
- 后续任务：plan_03 - 主进程 API 与基础服务；plan_04 - SM-2 算法与复习队列；plan_05 - AI 生成与 Provider 抽象；plan_06 - 渲染端基础框架与设计体系
- 产出数据：数据库表、共享 schema、类型定义

---

## 子任务分解
**每一个子任务都必须小而具体**

- sub_plan_01 - 确认字段与约束
  - 简述：梳理必填、默认值、时间格式与枚举取值
- sub_plan_02 - 定义共享校验 schema
  - 简述：用统一校验描述词条、设置、请求与响应格式
- sub_plan_03 - 设计数据库表结构
  - 简述：制定 SQLite 表结构与索引策略
- sub_plan_04 - 规划迁移与初始化
  - 简述：定义建表、默认值写入与初始检查流程
- sub_plan_05 - 编写数据访问约定
  - 简述：约定读写接口、事务与错误处理模式

---

## 技术方案

### 架构设计
共享 schema 驱动数据层，SQLite 持久化，数据访问通过仓储模式隔离调用方。

### 核心技术选型
- Zod schema：统一请求/响应与表单校验
- SQLite（better-sqlite3 或轻量迁移层）：本地持久化与同步访问

### 数据模型
核心表 words：
- id：整数主键自增
- word：文本
- reading：文本
- context_expl：文本
- scene_desc：文本
- example：文本
- difficulty：文本枚举（easy/medium/hard）
- ef：实数，默认 2.5
- interval_days：整数
- repetition：整数
- last_review_at：文本（ISO 时间）
- next_due_at：文本（ISO 时间）
- created_at：文本（ISO 时间）
- updated_at：文本（ISO 时间）

### 接口设计
抽象数据访问接口：创建、读取列表、按条件查询、更新、删除；提供批量读写与事务封装以支撑队列生成与统计。

---

## 执行摘要

### 输入
- 字段定义与 SM-2 规则
- 工作区与 TypeScript 工具链

### 处理
- 确定字段规则与默认值
- 生成共享 schema 与表结构
- 约定数据访问接口与迁移流程

### 输出
- words 表结构与索引方案
- 共享校验 schema 与类型
- 数据访问约定与初始化步骤

---

## 验收标准
**验收标准必须清晰明确**

### 功能验收
- words 表结构完整、字段及默认值与设计一致
- 共享 schema 覆盖词条、复习记录、设置、AI 请求响应
- 数据访问约定包含增删改查、批量与事务模式

### 质量验收
- 字段校验规则明确且可复用
- 迁移与初始化流程可重复执行无副作用

---

## 交付物清单

### 代码文件
- 数据访问与迁移约定：1 套

### 配置文件
- 数据库初始化配置：1 份

### 文档
- 字段说明与 schema 说明：1 份

### 测试文件
- 数据校验与存储测试计划：1 份
