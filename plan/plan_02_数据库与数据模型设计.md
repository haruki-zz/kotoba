# 计划：数据库与数据模型设计

## 计划概述

### 计划目标

设计并落地本地数据库结构，覆盖词条、调度字段、标签与元数据，建立迁移与访问约束。

### 在项目中的位置

作为数据源核心，为调度算法、API、渲染层提供一致的数据模型与持久化能力。

---

## 依赖关系

### 前置条件

- **前置任务**：plan_01 - 环境与基础框架搭建
- **前置数据**：需求中的字段与调度规则
- **前置环境**：SQLite 驱动与查询工具可用

### 后续影响

- **后续任务**：plan_03 - SM-2 调度核心；plan_04 - Fastify API 与数据访问层；plan_05 - AI 辅助功能与提示工程；plan_08 - Library 与内容管理
- **产出数据**：数据库模式定义、迁移脚本、访问约束

---

## 子任务分解

**每一个子任务都必须小而具体**

- sub_plan_01 - 梳理实体与字段
  - 简述：确认词条、调度、标签、来源等字段及约束
- sub_plan_02 - 设计表与索引
  - 简述：定义表结构、索引策略、唯一性与外键规则
- sub_plan_03 - 迁移与初始化
  - 简述：编写初始迁移与种子占位，建立版本控制
- sub_plan_04 - 数据访问抽象
  - 简述：定义数据访问接口抽象以供上层调用
- sub_plan_05 - 数据质量与备份策略
  - 简述：规划本地备份、恢复与一致性校验

---

## 技术方案

### 架构设计

采用本地 SQLite 单库，数据访问通过轻量 ORM/查询构建器与表级约束，统一在共享模式层描述。

### 核心技术选型

- **技术1**：SQLite + 同步驱动
- **技术2**：模式校验与类型生成工具

### 数据模型

核心表覆盖：词条主体、调度状态、标签与来源字段，含 EF、间隔、重复次数、时间戳等；关联表存储标签映射与来源信息。

### 接口设计

数据层提供抽象的读写接口（查询、插入、更新、软删除、批量导入），不直接暴露 SQL。

---

## 执行摘要

### 输入

- 需求字段列表
- SM-2 算法所需数据点

### 处理

- 建模与约束设计
- 迁移与初始数据占位
- 抽象数据访问接口

### 输出

- 已版本化的数据库模式
- 数据访问抽象定义
- 备份与一致性策略

---

## 验收标准

**验收标准必须清晰明确**

### 功能验收

- 数据库模式覆盖调度字段、时间戳、标签与来源
- 迁移可在空库上成功创建所有表与索引
- 数据访问抽象提供基础 CRUD 与批量导入接口

### 质量验收

- 字段类型、默认值、约束与索引定义齐全
- 迁移脚本可重复执行且具备版本号
- 模式文档与共享类型一致

---

## 交付物清单

### 代码文件

- 模式定义与迁移文件：覆盖全部表与索引
- 数据访问抽象定义：接口或类型声明

### 配置文件

- 数据库路径配置与环境变量占位

### 文档

- 模式说明与字段含义
- 备份与恢复流程说明

### 测试文件

- 数据层验证用例：覆盖创建、查询、更新、删除与约束校验
