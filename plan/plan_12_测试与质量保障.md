# 计划：测试与质量保障

## 计划概述

### 计划目标
建立覆盖算法、主进程 API、渲染端交互的测试体系，辅以 lint/format 检查与基本 CI 脚本，确保交付质量。

### 在项目中的位置
为所有功能提供验证与回归防护，是上线前的必经步骤。

---

## 依赖关系

### 前置条件
- 前置任务：plan_01 - 工作区搭建与工程规范；plan_02 - 数据模型与数据库；plan_03 - 主进程 API 与基础服务；plan_04 - SM-2 算法与复习队列；plan_06 - 渲染端基础框架与设计体系
- 前置数据：接口契约、算法规则、关键交互定义
- 前置环境：Vitest、React Testing Library、ESLint、Prettier 可用

### 后续影响
- 后续任务：可持续集成与发布流程
- 产出数据：测试用例、覆盖率报告、检查脚本

---

## 子任务分解
**每一个子任务都必须小而具体**

- sub_plan_01 - 制定测试策略与范围
  - 简述：明确单元、集成、UI 交互的覆盖目标与优先级
- sub_plan_02 - 配置测试工具链
  - 简述：设置 Vitest、React Testing Library、测试别名与模拟
- sub_plan_03 - 编写算法与数据层测试
  - 简述：覆盖 SM-2 公式、队列生成、数据校验与迁移
- sub_plan_04 - 编写主进程 API 测试
  - 简述：覆盖词条 CRUD、复习提交/回退、统计聚合
- sub_plan_05 - 编写渲染端交互测试
  - 简述：覆盖今日学习表单、复习流快捷键、删除确认等核心交互
- sub_plan_06 - 配置静态检查与格式化
  - 简述：运行 lint/format，确保规则无误
- sub_plan_07 - 生成报告与准入标准
  - 简述：定义通过阈值、生成覆盖率与检查报告
- sub_plan_08 - 回归与故障处理流程
  - 简述：制定失败重现、修复验证与用例补充流程

---

## 技术方案

### 架构设计
测试按层划分：算法与数据层单元测试，API 集成测试，渲染端组件与交互测试；统一使用 Vitest 运行，RTK 用于 UI。

### 核心技术选型
- Vitest：统一测试运行与断言
- React Testing Library：渲染端交互验证
- 覆盖率工具：集成于 Vitest

### 数据模型
测试夹具基于 words 表 schema 构造，包含各难度、时间与 EF 场景；模拟设置与统计数据。

### 接口设计
测试钩子与辅助方法：构造数据、调用 API、断言响应与状态；不对外暴露，仅服务测试。

---

## 执行摘要

### 输入
- 功能模块与接口契约
- 工具链与规则配置

### 处理
- 配置测试环境与别名
- 编写各层测试与覆盖率收集
- 运行 lint/format/check

### 输出
- 可运行的测试套件与覆盖率报告
- 静态检查通过的基线

---

## 验收标准
**验收标准必须清晰明确**

### 功能验收
- SM-2 核心分支、复习队列、词条 CRUD、统计聚合均有测试覆盖
- 今日学习、复习流、删除确认等关键交互有 UI 测试
- lint、format、test 脚本可在根目录直接运行通过

### 质量验收
- 覆盖率达到预设阈值（约定线路径）
- 测试可重复运行且无顺序依赖

---

## 交付物清单

### 代码文件
- 测试用例与辅助函数：1 套

### 配置文件
- 测试与覆盖率配置：1 份

### 文档
- 测试策略与准入标准说明：1 份

### 测试文件
- 全部测试用例与报告：1 套
